<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calcul Moyenne</title>
<link rel="icon" type="image/png" sizes="36x36" href="icons/android-icon-36x36.png">
<link rel="icon" type="image/png" sizes="48x48" href="icons/android-icon-48x48.png">
<link rel="icon" type="image/png" sizes="72x72" href="icons/android-icon-72x72.png">
<link rel="icon" type="image/png" sizes="96x96" href="icons/android-icon-96x96.png">
<link rel="icon" type="image/png" sizes="144x144" href="icons/android-icon-144x144.png">
<link rel="icon" type="image/png" sizes="192x192" href="icons/android-icon-192x192.png">

<link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-180x180.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-512x512.png">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2196f3">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        #app {
            width: 100%;
            max-width: 500px;
            background-color: #f5f5f5;
            min-height: 100vh;
            position: relative;
        }

        .screen-welcome {
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-container {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: rgba(33, 150, 243, 0.1);
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.3);
        }

        .logo {
            font-size: 50px;
        }

        h1 {
            font-size: 28px;
            color: #2196f3;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #757575;
            font-size: 16px;
        }

        .card {
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-label {
            color: #757575;
            font-weight: bold;
            font-size: 14px;
        }

        .theme-toggle {
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }

        .moyenne-container {
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .moyenne {
            font-size: 48px;
            font-weight: bold;
            color: #2196f3;
        }

        .moyenne-unit {
            font-size: 20px;
            color: #757575;
            margin-left: 4px;
            margin-bottom: 8px;
        }

        .section-title {
            color: #757575;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: space-between;
        }

        .semestre-card {
            width: calc(50% - 7.5px);
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .semestre-card:active {
            transform: scale(0.98);
        }

        .semestre-nom {
            color: #2196f3;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .progress-circle {
            width: 70px;
            height: 70px;
            border-radius: 35px;
            border: 4px solid #2196f3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
        }

        .progress-text {
            font-size: 18px;
            font-weight: bold;
            color: #2196f3;
        }

        .progress-unit {
            font-size: 10px;
            color: #757575;
        }

        .ue-badge {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .ue-badge-text {
            color: #757575;
            font-size: 12px;
        }

        .app-bar {
            background-color: #2196f3;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        .back-button {
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }

        .app-bar-title {
            font-size: 18px;
            font-weight: bold;
        }

        .fab {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 100;
        }

        .fab:active {
            transform: translateX(-50%) scale(0.95);
        }

        .fab-icon {
            font-size: 20px;
        }

        .list-content {
            padding: 16px;
            padding-bottom: 80px;
        }

        .ue-card, .mat-card, .note-card {
            background-color: white;
            border-radius: 15px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .ue-header, .mat-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .ue-icon, .mat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background-color: rgba(33, 150, 243, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 30px;
        }

        .ue-info, .mat-info {
            flex: 1;
        }

        .ue-nom, .mat-nom {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .ue-coef, .mat-coef {
            font-size: 14px;
            color: #757575;
        }

        .ue-moyenne-badge, .mat-moyenne-badge {
            background-color: #2196f3;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .mat-moyenne-badge {
            background-color: #4caf50;
        }

        .mat-moyenne-badge.faible {
            background-color: #f44336;
        }

        .ue-actions, .mat-actions {
            display: flex;
            justify-content: flex-end;
            border-top: 1px solid #e0e0e0;
            padding-top: 12px;
            gap: 12px;
        }

        .edit-button, .delete-button {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .edit-button {
            background-color: #fff3e0;
            color: #ff9800;
        }

        .delete-button {
            background-color: #ffebee;
            color: #f44336;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-end;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            width: 100%;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 24px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .input {
            width: 100%;
            padding: 14px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 16px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .cancel-button, .save-button {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
        }

        .cancel-button {
            background-color: #f5f5f5;
            color: #757575;
            border: 1px solid #e0e0e0;
        }

        .save-button {
            background-color: #2196f3;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
        }

        .empty-icon {
            font-size: 100px;
            color: #bdbdbd;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 20px;
            font-weight: bold;
            color: #757575;
            margin-bottom: 10px;
        }

        .empty-text {
            font-size: 16px;
            color: #9e9e9e;
        }

        .note-card {
            display: flex;
            align-items: center;
        }

        .note-avatar {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background-color: rgba(33, 150, 243, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .note-avatar span {
            font-size: 20px;
            font-weight: bold;
            color: #2196f3;
        }

        .note-info {
            flex: 1;
        }

        .note-nom {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .note-details {
            font-size: 14px;
            color: #757575;
        }

        .note-actions {
            display: flex;
            gap: 8px;
        }

        .note-edit, .note-delete {
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
        }

        .note-edit {
            background-color: #fff3e0;
        }

        .note-delete {
            background-color: #ffebee;
        }

        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 16px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4caf50;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .warning-text {
            color: #ff9800;
            font-style: italic;
            margin: 0 16px 16px;
            font-size: 14px;
        }

        .badge {
            padding: 8px 14px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .badge-green {
            background-color: #4caf50;
        }

        .badge-orange {
            background-color: #ff9800;
        }

        body.dark-mode {
            background-color: #121212;
        }

        body.dark-mode #app {
            background-color: #121212;
        }

        body.dark-mode .card,
        body.dark-mode .semestre-card,
        body.dark-mode .ue-card,
        body.dark-mode .mat-card,
        body.dark-mode .note-card,
        body.dark-mode .modal-content {
            background-color: #1e1e1e;
            color: white;
        }

        body.dark-mode .card-label,
        body.dark-mode .subtitle,
        body.dark-mode .section-title,
        body.dark-mode .ue-coef,
        body.dark-mode .mat-coef,
        body.dark-mode .note-details {
            color: #b0b0b0;
        }

        body.dark-mode .input {
            background-color: #2d2d2d;
            border-color: #404040;
            color: white;
        }

        body.dark-mode .ue-badge {
            background-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .ue-badge-text {
            color: #b0b0b0;
        }

        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        class Note {
            constructor(nom, valeur, pourcentage) {
                this.nom = nom;
                this.valeur = valeur;
                this.pourcentage = pourcentage;
            }

            get points() {
                return this.valeur * (this.pourcentage / 100);
            }
        }

        class Matiere {
            constructor(nom, coefficient) {
                this.nom = nom;
                this.coefficient = coefficient;
                this.notes = [];
            }

            get moyenne() {
                if (this.notes.length === 0) return 0;
                let totalPoints = 0;
                let totalPourcentage = 0;
                for (let n of this.notes) {
                    totalPoints += n.points;
                    totalPourcentage += n.pourcentage;
                }
                return totalPourcentage > 0 ? totalPoints : 0;
            }

            get moyenneSur20() {
                return this.moyenne;
            }
        }

        class UE {
            constructor(nom, coefficient) {
                this.nom = nom;
                this.coefficient = coefficient;
                this.matieres = [];
            }

            get moyenne() {
                if (this.matieres.length === 0) return 0;
                let totalPoints = 0;
                let totalCoefs = 0;
                for (let m of this.matieres) {
                    totalPoints += m.moyenneSur20 * m.coefficient;
                    totalCoefs += m.coefficient;
                }
                return totalCoefs > 0 ? totalPoints / totalCoefs : 0;
            }
        }

        class Semestre {
            constructor(nom) {
                this.nom = nom;
                this.ues = [];
            }

            get moyenne() {
                if (this.ues.length === 0) return 0;
                let totalPoints = 0;
                let totalCoefs = 0;
                for (let ue of this.ues) {
                    totalPoints += ue.moyenne * ue.coefficient;
                    totalCoefs += ue.coefficient;
                }
                return totalCoefs > 0 ? totalPoints / totalCoefs : 0;
            }
        }

        class App {
            constructor() {
                this.semestres = [
                    new Semestre('Semestre 1'),
                    new Semestre('Semestre 2')
                ];
                this.isDarkMode = false;
                this.currentScreen = 'welcome';
                this.selectedSemestre = null;
                this.selectedUE = null;
                this.selectedMatiere = null;
                
                this.modalUE = { visible: false, nom: '', coef: '1', isEdit: false, editItem: null };
                this.modalMatiere = { visible: false, nom: '', coef: '1', isEdit: false, editItem: null };
                this.modalNote = { visible: false, nom: '', valeur: '', pourcentage: '100', isEdit: false, editItem: null };

                this.loadData();
                this.render();
            }

            saveData() {
                try {
                    const data = {
                        semestres: this.semestres.map(s => ({
                            nom: s.nom,
                            ues: s.ues.map(u => ({
                                nom: u.nom,
                                coefficient: u.coefficient,
                                matieres: u.matieres.map(m => ({
                                    nom: m.nom,
                                    coefficient: m.coefficient,
                                    notes: m.notes.map(n => ({
                                        nom: n.nom,
                                        valeur: n.valeur,
                                        pourcentage: n.pourcentage
                                    }))
                                }))
                            }))
                        })),
                        isDarkMode: this.isDarkMode
                    };
                    localStorage.setItem('calcul_moyenne', JSON.stringify(data));
                } catch (e) {
                    console.log('Erreur sauvegarde', e);
                }
            }

            loadData() {
                try {
                    const data = localStorage.getItem('calcul_moyenne');
                    if (data) {
                        const parsed = JSON.parse(data);
                        this.semestres = parsed.semestres.map(s => {
                            const sem = new Semestre(s.nom);
                            sem.ues = s.ues.map(u => {
                                const ue = new UE(u.nom, u.coefficient);
                                ue.matieres = u.matieres.map(m => {
                                    const mat = new Matiere(m.nom, m.coefficient);
                                    mat.notes = m.notes.map(n => new Note(n.nom, n.valeur, n.pourcentage));
                                    return mat;
                                });
                                return ue;
                            });
                            return sem;
                        });
                        this.isDarkMode = parsed.isDarkMode || false;
                    }
                } catch (e) {
                    console.log('Erreur chargement', e);
                }
            }

            get moyenneGenerale() {
                let total = 0;
                let count = 0;
                for (let s of this.semestres) {
                    if (s.ues.length > 0) {
                        total += s.moyenne;
                        count++;
                    }
                }
                return count > 0 ? total / count : 0;
            }

            toggleTheme() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
                this.saveData();
                this.render();
            }

            ajouterUE(semestre, nom, coef) {
                semestre.ues.push(new UE(nom, parseFloat(coef) || 1));
                this.saveData();
                this.render();
            }

            modifierUE(ue, nom, coef) {
                ue.nom = nom;
                ue.coefficient = parseFloat(coef) || ue.coefficient;
                this.saveData();
                this.render();
            }

            supprimerUE(semestre, index) {
                semestre.ues.splice(index, 1);
                this.saveData();
                this.render();
            }

            ajouterMatiere(ue, nom, coef) {
                ue.matieres.push(new Matiere(nom, parseFloat(coef) || 1));
                this.saveData();
                this.render();
            }

            modifierMatiere(matiere, nom, coef) {
                matiere.nom = nom;
                matiere.coefficient = parseFloat(coef) || matiere.coefficient;
                this.saveData();
                this.render();
            }

            supprimerMatiere(ue, index) {
                ue.matieres.splice(index, 1);
                this.saveData();
                this.render();
            }

            ajouterNote(matiere, nom, valeur, pourcentage) {
                matiere.notes.push(new Note(nom, parseFloat(valeur), parseFloat(pourcentage)));
                this.saveData();
                this.render();
            }

            modifierNote(note, nom, valeur, pourcentage) {
                note.nom = nom;
                note.valeur = parseFloat(valeur);
                note.pourcentage = parseFloat(pourcentage);
                this.saveData();
                this.render();
            }

            supprimerNote(matiere, index) {
                matiere.notes.splice(index, 1);
                this.saveData();
                this.render();
            }

            render() {
                const app = document.getElementById('app');
                
                if (this.currentScreen === 'welcome') {
                    app.innerHTML = this.renderWelcome();
                } else if (this.currentScreen === 'semestre') {
                    app.innerHTML = this.renderSemestre();
                } else if (this.currentScreen === 'ue') {
                    app.innerHTML = this.renderUE();
                } else if (this.currentScreen === 'matiere') {
                    app.innerHTML = this.renderMatiere();
                }

                this.attachEvents();
            }

            renderWelcome() {
                return `
                    <div class="screen-welcome">
                        <div class="header">
                            <div class="logo-container">
                                <span class="logo">üìä</span>
                            </div>
                            <h1>Calcul Moyenne</h1>
                            <div class="subtitle">G√®re tes notes facilement sur mobile !</div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <span class="card-label">MOYENNE G√âN√âRALE</span>
                                <span class="theme-toggle" data-action="toggleTheme">${this.isDarkMode ? '‚òÄÔ∏è' : 'üåô'}</span>
                            </div>
                            <div class="moyenne-container">
                                <span class="moyenne">${this.moyenneGenerale.toFixed(2)}</span>
                                <span class="moyenne-unit">/20</span>
                            </div>
                        </div>

                        <div class="section-title">MES SEMESTRES</div>
                        
                        <div class="grid">
                            ${this.semestres.map((sem, index) => `
                                <div class="semestre-card" data-semestre-index="${index}">
                                    <div class="semestre-nom">${sem.nom}</div>
                                    <div class="progress-container">
                                        <div class="progress-circle">
                                            <span class="progress-text">${sem.ues.length === 0 ? '0.0' : sem.moyenne.toFixed(1)}</span>
                                            <span class="progress-unit">/20</span>
                                        </div>
                                    </div>
                                    <div class="ue-badge">
                                        <span class="ue-badge-text">${sem.ues.length === 0 ? '0 UE' : sem.ues.length + (sem.ues.length > 1 ? ' UEs' : ' UE')}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div style="text-align: center; padding: 20px; color: #757575;">
                            Fait par Samy.M
                        </div>
                    </div>
                `;
            }

            renderSemestre() {
                const sem = this.selectedSemestre;
                return `
                    <div>
                        <div class="app-bar">
                            <span class="back-button" data-action="back">‚Üê</span>
                            <span class="app-bar-title">${sem.nom}</span>
                            <span class="theme-toggle" data-action="toggleTheme">${this.isDarkMode ? '‚òÄÔ∏è' : 'üåô'}</span>
                        </div>

                        <div class="card" style="margin: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div class="card-label">Moyenne</div>
                                    <div style="display: flex; align-items: flex-end;">
                                        <span style="font-size: 32px; font-weight: bold; color: #2196f3;">${sem.ues.length === 0 ? '0.00' : sem.moyenne.toFixed(2)}</span>
                                        <span style="font-size: 16px; color: #757575; margin-left: 4px; margin-bottom: 4px;">/20</span>
                                    </div>
                                </div>
                                <div style="background-color: #2196f3; padding: 10px 16px; border-radius: 20px;">
                                    <span style="color: white; font-weight: bold;">${sem.ues.length} UE</span>
                                </div>
                            </div>
                        </div>

                        ${sem.ues.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">üìö</div>
                                <div class="empty-title">Aucune UE ajout√©e</div>
                                <div class="empty-text">Appuie sur le bouton + pour commencer</div>
                            </div>
                        ` : `
                            <div class="list-content">
                                ${sem.ues.map((ue, index) => `
                                    <div class="ue-card" data-ue-index="${index}">
                                        <div class="ue-header">
                                            <div class="ue-icon">üìñ</div>
                                            <div class="ue-info">
                                                <div class="ue-nom">${ue.nom}</div>
                                                <div class="ue-coef">Coefficient: ${ue.coefficient}</div>
                                            </div>
                                            <div class="ue-moyenne-badge">${ue.moyenne.toFixed(1)}/20</div>
                                        </div>
                                        <div class="ue-actions">
                                            <span class="edit-button" data-action="editUE" data-ue-index="${index}">‚úèÔ∏è Modifier</span>
                                            <span class="delete-button" data-action="deleteUE" data-ue-index="${index}">üóëÔ∏è Supprimer</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}

                        <button class="fab" data-action="addUE">
                            <span class="fab-icon">+</span>
                            <span>Ajouter UE</span>
                        </button>

                        ${this.renderModalUE()}
                    </div>
                `;
            }

            renderUE() {
                const ue = this.selectedUE;
                return `
                    <div>
                        <div class="app-bar" style="background-color: #4caf50;">
                            <span class="back-button" data-action="back">‚Üê</span>
                            <span class="app-bar-title">${ue.nom}</span>
                            <span class="theme-toggle" data-action="toggleTheme">${this.isDarkMode ? '‚òÄÔ∏è' : 'üåô'}</span>
                        </div>

                        <div class="card" style="margin: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div class="card-label">Moyenne UE</div>
                                    <div style="display: flex; align-items: flex-end;">
                                        <span style="font-size: 36px; font-weight: bold; color: #4caf50;">${ue.matieres.length === 0 ? '0.00' : ue.moyenne.toFixed(2)}</span>
                                        <span style="font-size: 16px; color: #757575; margin-left: 4px; margin-bottom: 4px;">/20</span>
                                    </div>
                                    <div class="ue-coef">Coefficient: ${ue.coefficient}</div>
                                </div>
                                <div style="background-color: #4caf50; padding: 10px 16px; border-radius: 20px;">
                                    <span style="color: white; font-weight: bold;">${ue.matieres.length} mati√®re${ue.matieres.length > 1 ? 's' : ''}</span>
                                </div>
                            </div>
                        </div>

                        ${ue.matieres.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">üìï</div>
                                <div class="empty-title">Aucune mati√®re ajout√©e</div>
                                <div class="empty-text">Appuie sur le bouton + pour ajouter une mati√®re</div>
                            </div>
                        ` : `
                            <div class="list-content">
                                ${ue.matieres.map((mat, index) => `
                                    <div class="mat-card" data-matiere-index="${index}">
                                        <div class="mat-header">
                                            <div class="mat-icon">üìò</div>
                                            <div class="mat-info">
                                                <div class="mat-nom">${mat.nom}</div>
                                                <div class="mat-coef">Coefficient: ${mat.coefficient}</div>
                                            </div>
                                            <div class="mat-moyenne-badge ${mat.moyenneSur20 < 10 ? 'faible' : ''}" style="background-color: ${mat.moyenneSur20 >= 10 ? '#4caf50' : '#f44336'}">
                                                ${mat.moyenneSur20.toFixed(1)}/20
                                            </div>
                                        </div>
                                        <div class="mat-actions">
                                            <span class="edit-button" data-action="editMatiere" data-matiere-index="${index}">‚úèÔ∏è Modifier</span>
                                            <span class="delete-button" data-action="deleteMatiere" data-matiere-index="${index}">üóëÔ∏è Supprimer</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}

                        <button class="fab" style="background-color: #4caf50;" data-action="addMatiere">
                            <span class="fab-icon">+</span>
                            <span>Ajouter mati√®re</span>
                        </button>

                        ${this.renderModalMatiere()}
                    </div>
                `;
            }

            renderMatiere() {
                const mat = this.selectedMatiere;
                const totalPourcentage = mat.notes.reduce((sum, n) => sum + n.pourcentage, 0);
                const moyenneColor = mat.moyenneSur20 >= 10 ? '#4caf50' : '#f44336';

                return `
                    <div>
                        <div class="app-bar" style="background-color: #9c27b0;">
                            <span class="back-button" data-action="back">‚Üê</span>
                            <span class="app-bar-title">${mat.nom}</span>
                            <span class="theme-toggle" data-action="toggleTheme">${this.isDarkMode ? '‚òÄÔ∏è' : 'üåô'}</span>
                        </div>

                        <div class="card" style="margin: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div class="card-label">Moyenne</div>
                                    <div style="display: flex; align-items: flex-end;">
                                        <span style="font-size: 36px; font-weight: bold; color: ${moyenneColor};">${mat.notes.length === 0 ? '0.00' : mat.moyenneSur20.toFixed(2)}</span>
                                        <span style="font-size: 16px; color: #757575; margin-left: 4px; margin-bottom: 4px;">/20</span>
                                    </div>
                                    <div class="mat-coef">Coefficient: ${mat.coefficient}</div>
                                </div>
                                <div class="badge ${totalPourcentage === 100 ? 'badge-green' : 'badge-orange'}">
                                    ${totalPourcentage.toFixed(0)}%
                                </div>
                            </div>
                        </div>

                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(mat.moyenneSur20 / 20) * 100}%; background-color: ${moyenneColor};"></div>
                        </div>

                        ${totalPourcentage !== 100 && mat.notes.length > 0 ? `
                            <div class="warning-text">
                                ‚ö†Ô∏è Total: ${totalPourcentage.toFixed(0)}% (doit faire 100%)
                            </div>
                        ` : ''}

                        ${mat.notes.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">üìù</div>
                                <div class="empty-title">Aucune note ajout√©e</div>
                                <div class="empty-text">Appuie sur le bouton + pour ajouter une note</div>
                            </div>
                        ` : `
                            <div class="list-content">
                                ${mat.notes.map((note, index) => `
                                    <div class="note-card">
                                        <div class="note-avatar">
                                            <span>${note.valeur.toFixed(1)}</span>
                                        </div>
                                        <div class="note-info">
                                            <div class="note-nom">${note.nom}</div>
                                            <div class="note-details">${note.valeur.toFixed(1)}/20 ‚Ä¢ ${note.pourcentage}%</div>
                                        </div>
                                        <div class="note-actions">
                                            <span class="note-edit" data-action="editNote" data-note-index="${index}">‚úèÔ∏è</span>
                                            <span class="note-delete" data-action="deleteNote" data-note-index="${index}">üóëÔ∏è</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}

                        <button class="fab" style="background-color: #9c27b0;" data-action="addNote">
                            <span class="fab-icon">+</span>
                            <span>Ajouter note</span>
                        </button>

                        ${this.renderModalNote()}
                    </div>
                `;
            }

            renderModalUE() {
                if (!this.modalUE.visible) return '';
                return `
                    <div class="modal-overlay" data-action="closeModal">
                        <div class="modal-content">
                            <div class="modal-title">${this.modalUE.isEdit ? 'Modifier UE' : 'Nouvelle UE'}</div>
                            <input type="text" class="input" placeholder="Nom de l'UE" id="modal-ue-nom" value="${this.modalUE.nom}">
                            <input type="number" class="input" placeholder="Coefficient" id="modal-ue-coef" value="${this.modalUE.coef}" step="0.1">
                            <div class="modal-actions">
                                <span class="cancel-button" data-action="closeModal">Annuler</span>
                                <span class="save-button" data-action="saveUE">${this.modalUE.isEdit ? 'Modifier' : 'Ajouter'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderModalMatiere() {
                if (!this.modalMatiere.visible) return '';
                return `
                    <div class="modal-overlay" data-action="closeModal">
                        <div class="modal-content">
                            <div class="modal-title">${this.modalMatiere.isEdit ? 'Modifier Mati√®re' : 'Nouvelle Mati√®re'}</div>
                            <input type="text" class="input" placeholder="Nom de la mati√®re" id="modal-matiere-nom" value="${this.modalMatiere.nom}">
                            <input type="number" class="input" placeholder="Coefficient" id="modal-matiere-coef" value="${this.modalMatiere.coef}" step="0.1">
                            <div class="modal-actions">
                                <span class="cancel-button" data-action="closeModal">Annuler</span>
                                <span class="save-button" data-action="saveMatiere">${this.modalMatiere.isEdit ? 'Modifier' : 'Ajouter'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderModalNote() {
                if (!this.modalNote.visible) return '';
                return `
                    <div class="modal-overlay" data-action="closeModal">
                        <div class="modal-content">
                            <div class="modal-title">${this.modalNote.isEdit ? 'Modifier Note' : 'Nouvelle Note'}</div>
                            <input type="text" class="input" placeholder="Nom (DS, TP, Examen...)" id="modal-note-nom" value="${this.modalNote.nom}">
                            <input type="number" class="input" placeholder="Note /20" id="modal-note-valeur" value="${this.modalNote.valeur}" step="0.1" min="0" max="20">
                            <input type="number" class="input" placeholder="Pourcentage (%)" id="modal-note-pourcentage" value="${this.modalNote.pourcentage}" step="1" min="0" max="100">
                            <div class="modal-actions">
                                <span class="cancel-button" data-action="closeModal">Annuler</span>
                                <span class="save-button" data-action="saveNote">${this.modalNote.isEdit ? 'Modifier' : 'Ajouter'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            attachEvents() {
                document.querySelectorAll('[data-action="toggleTheme"]').forEach(el => {
                    el.addEventListener('click', () => this.toggleTheme());
                });

                document.querySelectorAll('[data-action="back"]').forEach(el => {
                    el.addEventListener('click', () => {
                        if (this.currentScreen === 'semestre') this.currentScreen = 'welcome';
                        else if (this.currentScreen === 'ue') this.currentScreen = 'semestre';
                        else if (this.currentScreen === 'matiere') this.currentScreen = 'ue';
                        this.render();
                    });
                });

                if (this.currentScreen === 'welcome') {
                    document.querySelectorAll('.semestre-card').forEach(el => {
                        el.addEventListener('click', (e) => {
                            const index = e.currentTarget.dataset.semestreIndex;
                            this.selectedSemestre = this.semestres[index];
                            this.currentScreen = 'semestre';
                            this.render();
                        });
                    });
                }

                if (this.currentScreen === 'semestre') {
                    document.querySelectorAll('.ue-card').forEach(el => {
                        el.addEventListener('click', (e) => {
                            if (e.target.classList.contains('edit-button') || e.target.classList.contains('delete-button')) return;
                            const index = e.currentTarget.dataset.ueIndex;
                            this.selectedUE = this.selectedSemestre.ues[index];
                            this.currentScreen = 'ue';
                            this.render();
                        });
                    });
                }

                if (this.currentScreen === 'ue') {
                    document.querySelectorAll('.mat-card').forEach(el => {
                        el.addEventListener('click', (e) => {
                            if (e.target.classList.contains('edit-button') || e.target.classList.contains('delete-button')) return;
                            const index = e.currentTarget.dataset.matiereIndex;
                            this.selectedMatiere = this.selectedUE.matieres[index];
                            this.currentScreen = 'matiere';
                            this.render();
                        });
                    });
                }

                if (this.currentScreen === 'semestre') {
                    document.querySelectorAll('[data-action="addUE"]').forEach(el => {
                        el.addEventListener('click', () => {
                            this.modalUE = { visible: true, nom: '', coef: '1', isEdit: false, editItem: null };
                            this.render();
                        });
                    });

                    document.querySelectorAll('[data-action="editUE"]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const index = e.currentTarget.dataset.ueIndex;
                            const ue = this.selectedSemestre.ues[index];
                            this.modalUE = { 
                                visible: true, 
                                nom: ue.nom, 
                                coef: ue.coefficient.toString(), 
                                isEdit: true, 
                                editItem: ue,
                                editIndex: index
                            };
                            this.render();
                        });
                    });

                    document.querySelectorAll('[data-action="deleteUE"]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const index = e.currentTarget.dataset.ueIndex;
                            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette UE ?')) {
                                this.supprimerUE(this.selectedSemestre, index);
                            }
                        });
                    });
                }

                if (this.currentScreen === 'ue') {
                    document.querySelectorAll('[data-action="addMatiere"]').forEach(el => {
                        el.addEventListener('click', () => {
                            this.modalMatiere = { visible: true, nom: '', coef: '1', isEdit: false, editItem: null };
                            this.render();
                        });
                    });

                    document.querySelectorAll('[data-action="editMatiere"]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const index = e.currentTarget.dataset.matiereIndex;
                            const mat = this.selectedUE.matieres[index];
                            this.modalMatiere = { 
                                visible: true, 
                                nom: mat.nom, 
                                coef: mat.coefficient.toString(), 
                                isEdit: true, 
                                editItem: mat,
                                editIndex: index
                            };
                            this.render();
                        });
                    });

                    document.querySelectorAll('[data-action="deleteMatiere"]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const index = e.currentTarget.dataset.matiereIndex;
                            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette mati√®re ?')) {
                                this.supprimerMatiere(this.selectedUE, index);
                            }
                        });
                    });
                }

                if (this.currentScreen === 'matiere') {
                    document.querySelectorAll('[data-action="addNote"]').forEach(el => {
                        el.addEventListener('click', () => {
                            this.modalNote = { visible: true, nom: '', valeur: '', pourcentage: '100', isEdit: false, editItem: null };
                            this.render();
                        });
                    });

                    document.querySelectorAll('[data-action="editNote"]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const index = e.currentTarget.dataset.noteIndex;
                            const note = this.selectedMatiere.notes[index];
                            this.modalNote = { 
                                visible: true, 
                                nom: note.nom, 
                                valeur: note.valeur.toString(), 
                                pourcentage: note.pourcentage.toString(), 
                                isEdit: true, 
                                editItem: note,
                                editIndex: index
                            };
                            this.render();
                        });
                    });

                    document.querySelectorAll('[data-action="deleteNote"]').forEach(el => {
                        el.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const index = e.currentTarget.dataset.noteIndex;
                            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette note ?')) {
                                this.supprimerNote(this.selectedMatiere, index);
                            }
                        });
                    });
                }

                document.querySelectorAll('[data-action="closeModal"]').forEach(el => {
                    el.addEventListener('click', (e) => {
                        if (e.target === e.currentTarget || e.currentTarget.classList.contains('cancel-button')) {
                            this.modalUE.visible = false;
                            this.modalMatiere.visible = false;
                            this.modalNote.visible = false;
                            this.render();
                        }
                    });
                });

                document.querySelectorAll('[data-action="saveUE"]').forEach(el => {
                    el.addEventListener('click', () => {
                        const nom = document.getElementById('modal-ue-nom')?.value;
                        const coef = document.getElementById('modal-ue-coef')?.value;
                        if (nom && nom.trim()) {
                            if (this.modalUE.isEdit) {
                                this.modifierUE(this.modalUE.editItem, nom, coef);
                            } else {
                                this.ajouterUE(this.selectedSemestre, nom, coef);
                            }
                            this.modalUE.visible = false;
                            this.render();
                        }
                    });
                });

                document.querySelectorAll('[data-action="saveMatiere"]').forEach(el => {
                    el.addEventListener('click', () => {
                        const nom = document.getElementById('modal-matiere-nom')?.value;
                        const coef = document.getElementById('modal-matiere-coef')?.value;
                        if (nom && nom.trim()) {
                            if (this.modalMatiere.isEdit) {
                                this.modifierMatiere(this.modalMatiere.editItem, nom, coef);
                            } else {
                                this.ajouterMatiere(this.selectedUE, nom, coef);
                            }
                            this.modalMatiere.visible = false;
                            this.render();
                        }
                    });
                });

                document.querySelectorAll('[data-action="saveNote"]').forEach(el => {
                    el.addEventListener('click', () => {
                        const nom = document.getElementById('modal-note-nom')?.value;
                        const valeur = document.getElementById('modal-note-valeur')?.value;
                        const pourcentage = document.getElementById('modal-note-pourcentage')?.value;
                        
                        if (nom && nom.trim() && valeur && valeur.trim()) {
                            const valNum = parseFloat(valeur) || 0;
                            const pctNum = parseFloat(pourcentage) || 100;
                            
                            if (valNum >= 0 && valNum <= 20 && pctNum >= 0 && pctNum <= 100) {
                                if (this.modalNote.isEdit) {
                                    this.modifierNote(this.modalNote.editItem, nom, valeur, pourcentage);
                                } else {
                                    this.ajouterNote(this.selectedMatiere, nom, valeur, pourcentage);
                                }
                                this.modalNote.visible = false;
                                this.render();
                            }
                        }
                    });
                });
            }
        }

        const app = new App();
    </script>
</body>
</html>